<!--*******************************************************************
*** File Name : Home.html
*** Version : V1.0
*** Designer : 新保　陽己
*** Date : 2024.6.11
*** Purpose : W2 ホーム画面を表示する
***
*******************************************************************-->
<!DOCTYPE html>
<html lang="ja">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>ホーム画面</title>
	<style>
		body {
			font-family: "MS Gothic", sans-serif;
			margin: 0;
			padding: 0;
			background-color: #f0f0f0;
		}

		.container {
			max-width: 1200px;
			margin: 0 auto;
			padding: 20px;
			background-color: #ffffff;
			box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
		}

		.header,
		.footer {
			text-align: center;
			padding: 10px;
			background-color: #333;
			color: #ffffff;
		}

		.header h1,
		.footer p {
			margin: 0;
		}

		.flex-container {
			display: flex;
			flex-wrap: wrap;
			justify-content: space-between;
			margin-bottom: 20px;
		}

		.flex-item {
			flex: 1;
			min-width: 300px;
			margin: 10px;
			padding: 20px;
			background-color: #fafafa;
			border: 1px solid #ddd;
			border-radius: 5px;
		}

		label,
		select,
		input,
		button {
			display: block;
			margin-bottom: 10px;
			font-size: 16px;
			width: 100%;
			padding: 8px;
			box-sizing: border-box;
		}

		select {
			appearance: none;
			border: 1px solid #ccc;
			border-radius: 5px;
			background-color: #fff;
		}

		input[type="text"] {
			border: 1px solid #ccc;
			border-radius: 5px;
		}

		button {
			background-color: #333;
			color: #fff;
			border: none;
			border-radius: 5px;
			cursor: pointer;
		}

		button:hover {
			background-color: #555;
		}

		.time-select {
			display: flex;
			align-items: center;
		}

		.time-select select {
			width: 80px;
			margin-right: 5px;
		}

		.time-select span {
			margin-right: 5px;
		}

		.project-list ul {
			list-style-type: none;
			padding: 0;
		}

		.project-list li {
			margin-bottom: 10px;
			padding: 10px;
			background-color: #f9f9f9;
			border: 1px solid #ddd;
			border-radius: 5px;
		}

		.project-list li button {
			display: inline-block;
			margin-left: 10px;
		}
	</style>
</head>

<body>
	<div class="header">
		<h1>ホーム画面</h1>
	</div>

	<div class="container">
		<div class="flex-container">
			<div class="flex-item">
				<!--企画作成部分-->
				<h2>企画作成</h2>
				<label for="projectName">企画名:</label>
				<input type="text" id="projectName" name="projectName" maxlength="16">

				<label for="category">カテゴリ:</label>
				<select id="category" name="category">
					<option value="event">イベント</option>
					<option value="facility">店・施設</option>
				</select>

				<label for="region">地域:</label>
				<select id="region" name="region">
					<option value="北海道" data-pref-id="01">北海道</option>
					<option value="青森県" data-pref-id="02">青森県</option>
					<option value="岩手県" data-pref-id="03">岩手県</option>
					<option value="宮城県" data-pref-id="04">宮城県</option>
					<option value="秋田県" data-pref-id="05">秋田県</option>
					<option value="山形県" data-pref-id="06">山形県</option>
					<option value="福島県" data-pref-id="07">福島県</option>
					<option value="茨城県" data-pref-id="08">茨城県</option>
					<option value="栃木県" data-pref-id="09">栃木県</option>
					<option value="群馬県" data-pref-id="10">群馬県</option>
					<option value="埼玉県" data-pref-id="11">埼玉県</option>
					<option value="千葉県" data-pref-id="12">千葉県</option>
					<option value="東京都" data-pref-id="13">東京都</option>
					<option value="神奈川県" data-pref-id="14">神奈川県</option>
					<option value="新潟県" data-pref-id="15">新潟県</option>
					<option value="富山県" data-pref-id="16">富山県</option>
					<option value="石川県" data-pref-id="17">石川県</option>
					<option value="福井県" data-pref-id="18">福井県</option>
					<option value="山梨県" data-pref-id="19">山梨県</option>
					<option value="長野県" data-pref-id="20">長野県</option>
					<option value="岐阜県" data-pref-id="21">岐阜県</option>
					<option value="静岡県" data-pref-id="22">静岡県</option>
					<option value="愛知県" data-pref-id="23">愛知県</option>
					<option value="三重県" data-pref-id="24">三重県</option>
					<option value="滋賀県" data-pref-id="25">滋賀県</option>
					<option value="京都府" data-pref-id="26">京都府</option>
					<option value="大阪府" data-pref-id="27">大阪府</option>
					<option value="兵庫県" data-pref-id="28">兵庫県</option>
					<option value="奈良県" data-pref-id="29">奈良県</option>
					<option value="和歌山県" data-pref-id="30">和歌山県</option>
					<option value="鳥取県" data-pref-id="31">鳥取県</option>
					<option value="島根県" data-pref-id="32">島根県</option>
					<option value="岡山県" data-pref-id="33">岡山県</option>
					<option value="広島県" data-pref-id="34">広島県</option>
					<option value="山口県" data-pref-id="35">山口県</option>
					<option value="徳島県" data-pref-id="36">徳島県</option>
					<option value="香川県" data-pref-id="37">香川県</option>
					<option value="愛媛県" data-pref-id="38">愛媛県</option>
					<option value="高知県" data-pref-id="39">高知県</option>
					<option value="福岡県" data-pref-id="40">福岡県</option>
					<option value="佐賀県" data-pref-id="41">佐賀県</option>
					<option value="長崎県" data-pref-id="42">長崎県</option>
					<option value="熊本県" data-pref-id="43">熊本県</option>
					<option value="大分県" data-pref-id="44">大分県</option>
					<option value="宮崎県" data-pref-id="45">宮崎県</option>
					<option value="鹿児島県" data-pref-id="46">鹿児島県</option>
					<option value="沖縄県" data-pref-id="47">沖縄県</option>
				</select>

				<button id="EventMainInput">企画作成</button>
			</div>

			<div class="flex-item">
				<!--参加登録部分-->
				<h2>参加登録</h2>
				<label for="projectID">企画ID:</label>
				<input type="text" id="projectID" name="projectID" maxlength="16">
				<button id="MemberMainInput">参加登録</button>
			</div>
		</div>

		<div class="flex-item project-list">
			<!-- 参加中企画についての表示 -->
			<h2>参加中の企画情報 </h2>
			<ul id="projectList"></ul>
		</div>
	</div>


	<!--呼び出す関数-->
	<script src="EventMainInput.js"></script>
	<script src="MemberMainInput.js"></script>
	<script>
		//企画作成をクリックで関数呼び出し
		document.addEventListener('DOMContentLoaded', function () {
			// 企画作成ボタンのクリックイベント
			document.getElementById('EventMainInput').addEventListener('click', function () {
				const managerName = sessionStorage.getItem('displayName');
				const managerID = parseInt(sessionStorage.getItem('userID'));
				const projectName = document.getElementById('projectName').value;
				const category = document.getElementById('category').value;
				const region = document.getElementById('region').value;
				const time_hour = '0';
				const time_minute = '0';
				EventMainInput(managerName, managerID, projectName, category, region, time_hour, time_minute);
			});

			// 参加登録ボタンのクリックイベント
			document.getElementById('MemberMainInput').addEventListener('click', function () {
				const projectID = document.getElementById('projectID').value;
				MemberMainInput(projectID);
			});
		});

		document.addEventListener('DOMContentLoaded', function () {
			// サーバからデータを取得する
			fetch('/Nine2/api/data/') // リクエストURLを適宜修正する
				.then(response => response.json())
				.then(data => {
					const userID = sessionStorage.getItem('userID'); // 参照するuserIDを設定

					// userIDが一致する参加者情報を表示する
					const projectList = document.getElementById('projectList');
					data.forEach(item => {
						if (item.participants) {
							item.participants.forEach(participant => {
								if (participant.userID == userID) {
									// 参加者情報がある場合、企画情報をリストに追加
									if (item.status != 'Notification') {
										const listItem = document.createElement('li');
										listItem.textContent = `企画ID: ${item.projectID}, 企画名: ${item.projectName}, カテゴリ: ${item.category == 'event' ? 'イベント' : '店・施設'}, 地域: ${item.region}`;
										const moveButton = document.createElement('button');
										moveButton.textContent = '移動';
										moveButton.addEventListener('click', function () {
											// クリック時の処理：セッションにprojectIDを保存してJoinDisplay.htmlに遷移する
											sessionStorage.setItem('projectID', item.projectID);
											const url = `/Nine2/api/data/`;
											const requestData = {
												action: 'move',
												projectID: item.projectID,
												userID: userID
											};
											fetch(url, {
												method: 'POST',
												headers: {
													'Content-Type': 'application/json'
												},
												body: JSON.stringify(requestData)
											})
												.then(response => {
													if (!response.ok) {
														throw new Error('Network response was not ok');
													}
													if (response.url == "/Nine2/Home.html") {
														alert('企画は決定しています。');
													}
													return response.json();
												})
												.then(data => {
													if (data.redirectUrl) {
														window.location.replace(data.redirectUrl);
													}
												})
												.catch(error => {
													console.error('Error declining project:', error);
													alert('企画への移動中にエラーが発生しました。');
												});

										});
										listItem.appendChild(moveButton);
										const disposeButton = document.createElement('button');
										disposeButton.textContent = '破棄';
										if (userID == item.managerID) {
											disposeButton.style.display = 'inline-block';
										} else {
											disposeButton.style.display = 'none';
										}
										disposeButton.addEventListener('click', function () {
											const projectID = item.projectID.toString();
											const url = `/Nine2/api/data`;
											const requestData = {
												action: 'dispose',
												projectID: projectID
											};
											fetch(url, {
												method: 'POST',
												headers: {
													'Content-Type': 'application/json'
												},
												body: JSON.stringify(requestData)
											})
												.then(response => {
													if (!response.ok) {
														throw new Error('Network response was not ok');
													}
													return response.json();
												})
												.then(data => {
													alert('企画が正常に破棄されました。');
													window.location.href = '/Nine2/Home.html';
												})
												.catch(error => {
													console.error('Error disposing project:', error);
													alert('企画の破棄中にエラーが発生しました。');
												});
										});
										listItem.appendChild(disposeButton);
										projectList.appendChild(listItem);
									}
								}
							});


						}
					});
				})
				.catch(error => console.error('Error fetching data:', error));
		});
	</script>
</body>

</html>